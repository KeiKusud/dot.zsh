# git svn で情報表示
autoload -Uz vcs_info

zstyle ':vcs_info:*' formats '[%b]'
zstyle ':vcs_info:*' actionformats '[%b|%a]'

precmd () {
  psvar=()
  LANG=en_US.UTF-8 vcs_info
  [[ -n "$vcs_info_msg_0_" ]] && psvar[1]="$vcs_info_msg_0_"
}

RPROMPT="%1(v|%F{green}%1v%f|)[%~]"

# tramp-mode
# cf: http://www.emacswiki.org/emacs/TrampMode
if [[ "$TERM" == "dumb" ]]; then
  unsetopt zle
  unsetopt prompt_cr
  unsetopt prompt_subst
  unfunction precmd
  unfunction preexec
  PS1='$ '
fi

# TeX -> PDF 一発変換
function textopdf () {
  file=$1
  if platex $file; then
    echo "\n--platex exit--\n"
    if dvipdfmx ${file%tex}dvi; then
      echo "\n--dvipdfmx exit--\n"
    else
      echo "Look ${file%tex}log"
    fi
  fi
}

# カレントディレクトリをお手軽サーバに
function server () {
  port=$1
  python -m SimpleHTTPServer $1
}

# zsh の man を表示
function zman () {
  PAGER="less -g -s '+/^       "$1"'" man zshall
}

# Emacs の現在のバッファに対応するディレクトリに cd する
# cf: http://d.hatena.ne.jp/syohex/20111026/1319606395
function cde () {
  EMACS_CWD=`emacsclient -e "
      (if (featurep 'elscreen)
          (elscreen-current-directory)
        (non-elscreen-current-directory))" | sed 's/^"\(.*\)"$/\1/'`

  echo "chdir to $EMACS_CWD"
  cd "$EMACS_CWD"
}

# tmuxの環境変数をリフレッシュする
# もっといい策を考えたい！
function tmux-session-refresh () {
  if [ -n "$TMUX" ]; then
    unset $(tmux show-env | sed -n 's/^-//p')
    eval export $(tmux show-env | sed -n 's/$/"/; s/=/="/p')
  fi
}
